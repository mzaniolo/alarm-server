<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8" />
  <title>hello-wasm example</title>
</head>

<body>
  <p>Alarm Server tester</p>
  <label for="name">alarm server addr:</label><br />

  <input type="text" id="addr" name="addr" value="wss://probable-halibut-5vqvv7xpv943j5p-8080.app.github.dev/" required
    minlength="6" size="80" />
  <button id="connect_btn">Connect</button>
  <br /><br />

  <label for="name">Subscribe to alarm:</label><br />
  <input type="text" id="subs" name="subs" value="sub2/alarm1" required minlength="6" size="80" />
  <button id="subs_btn">Subscribe</button>
  <br /><br />

  <label for="name">Acknowledge alarm:</label><br />
  <input type="text" id="ack" name="ack" value="sub2/alarm1" required minlength="6" size="80" />
  <button id="ack_btn">Acknowledge</button>
  <br /><br />

  <textarea type="text" name="content" id="content">
  </textarea>

  <br /><br />
  <button id="disc_btn">Disconnect</button>
  <button id="clear_btn">Clear log</button>


  <script type="module">
    import init, { AlarmClient } from "./pkg/wasm_client.js";
    let interval;
    let alm_srv
    init()

    function connect_alarm_server() {
      let addr = document.getElementById("addr").value

      alm_srv = new AlarmClient(addr);

      alm_srv.set_onopen(function () {
        console.log("ws open");

        // to Keep the connection alive
        interval = setInterval(() => {
          alm_srv.send_keep_alive();
        }, 12000);
      })



      alm_srv.set_onmessage(function (msg) {
        document.getElementById("content").value = msg + document.getElementById("content").value
      })
    }

    console.log("adding event")
    document.getElementById("connect_btn").addEventListener("click", connect_alarm_server);
    document.getElementById("subs_btn").addEventListener("click", function () { alm_srv.subscribe(document.getElementById("subs").value) });
    document.getElementById("ack_btn").addEventListener("click", function () { alm_srv.acknowledge(document.getElementById("ack").value) });


    document.getElementById("disc_btn").addEventListener("click", function () { alm_srv.close() });
    document.getElementById("clear_btn").addEventListener("click", function () { document.getElementById("content").value = "" });

  </script>
</body>

</html>
